<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PromotionEventMapper">

    <select id="getPromotionEventList" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.RawPromotionEvent">
        SELECT /* CachedExtraInfoManager.getPromotionEventList, 정희원/SKP, 2015-07-17 */
            TENANT_ID,
            PROM_TYPE_CD,
            PROM_TYPE_VALUE,
            to_char(START_DT,'yyyyMMddHH24miss')||'_'||to_char(END_DT,'yyyyMMddHH24miss') as DATETIME_KEY,
            PROM_ID,
            ACML_METHOD_CD,
            ACML_LIMT,
            TO_CHAR(ACML_DATE, 'yyyyMMddHH24miss') as ACML_DT,
            RATE_GRD_1,
            RATE_GRD_2,
            RATE_GRD_3,
            START_DT,
            END_DT
        FROM TB_DP_PROM_POLICY
        WHERE 1=1
          <if test="liveOnly || liveAndReserved">AND PROM_FORCE_CLOSE_CD IS NULL</if>
          <if test="liveOnly">AND sysdate between START_DT AND END_DT</if>
          <if test="liveAndReserved">AND sysdate <![CDATA[<]]> END_DT</if>
          <if test="tenantId != null">AND TENANT_ID = #{tenantId}</if>
          <if test="keyList != null">AND PROM_TYPE_VALUE IN <foreach collection="keyList" separator="," open="(" close=")" item="v">#{v}</foreach></if>
          <if test="promId != null">AND PROM_ID = #{promId}</if>
          <if test="liveAndReserved">ORDER BY TENANT_ID, PROM_TYPE_VALUE, START_DT</if>
          <if test="liveOnly">ORDER BY PROM_TYPE_CD</if>
    </select>
    
</mapper>
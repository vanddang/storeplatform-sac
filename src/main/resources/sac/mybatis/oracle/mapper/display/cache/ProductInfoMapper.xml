<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProductInfo">

    <select id="getAppMeta" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.AppMeta">
        SELECT
            /* ProductInfoMapper.xml, getAppMeta, 정희원, 2014-03-05 */
              PROD.PROD_ID
            , PROD.PROD_ID AS PART_PROD_ID
            , PROD.PROD_CHRG_YN AS PROD_CHRG
            , PROD.PROD_GRD_CD
            , PROD.DRM_YN
            , PROD.REG_DT
            , PROD.CONTENTS_TYPE_CD
            , APROD.AID
            , APROD.VER_MAJOR || '.' || APROD.VER_MINOR AS PROD_VER
            , APROD.PART_PARENT_CLSF_CD
            , PDESC.PROD_NM
            , PDESC.PROD_BASE_DESC
            , TPP.PROD_AMT
            , IMG.FILE_PATH AS IMAGE_PATH
            , IMG.FILE_SIZE AS IMAGE_SIZE
            , NVL(TPS.PATICPERS_CNT, 0) AS PATICPERS_CNT
            , NVL(TPS.PRCHS_CNT, 0) AS PRCHS_CNT
            <![CDATA[
              , NVL((CASE WHEN (TPS.AVG_EVLU_SCORE > 0 AND TPS.AVG_EVLU_SCORE < 1) THEN 1
                          WHEN TPS.AVG_EVLU_SCORE > 5 THEN 5
                          ELSE ROUND(TPS.AVG_EVLU_SCORE, 1) END), 0) AS AVG_EVLU_SCORE
            ]]>
            , PDESC.PROD_DTL_DESC
            , TP.PROD_STATUS_CD
        FROM TB_DP_PROD PROD
            INNER JOIN TB_DP_APP_PROD APROD
                ON APROD.PROD_ID = PROD.PROD_ID
            INNER JOIN TB_DP_PROD_DESC PDESC
                ON PDESC.PROD_ID = PROD.PROD_ID -- PDESC.LANG_CD
            INNER JOIN TB_DP_TENANT_PROD TP
                ON TP.PROD_ID = PROD.PROD_ID -- TP.TENANT_ID
            INNER JOIN TB_DP_TENANT_PROD_PRICE TPP
                ON TPP.PROD_ID = PROD.PROD_ID AND TPP.TENANT_ID = TP.TENANT_ID
            INNER JOIN TB_DP_PROD_IMG IMG
                ON IMG.PROD_ID = PROD.PROD_ID AND IMG.LANG_CD = PDESC.LANG_CD
            LEFT OUTER JOIN TB_DP_TENANT_PROD_STATS TPS
                ON TPS.PROD_ID = PROD.PROD_ID AND TPS.TENANT_ID = TP.TENANT_ID
        WHERE 1=1
              AND PROD.PROD_ID = #{channelId}
              AND PDESC.LANG_CD = #{langCd}
              AND TP.TENANT_ID = #{tenantId}
              AND SYSDATE BETWEEN TPP.APPLY_START_DT AND TPP.APPLY_END_DT
              AND TP.EXPO_YN = 'Y'
              AND IMG.IMG_CD = #{imageCd}  --'DP000101'
              AND IMG.EXPO_ORD = 1  -- 노출순서
              AND PROD.SVC_GRP_CD = #{svcGrpCd}  -- DP000201 : App
    </select>

    <select id="getAppMetaList" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.AppMeta">
        SELECT /* ProductInfoMapper.xml, getAppMetaList, 정희원, 2014-04-07 */
            PROD.PROD_ID
            , PROD.PROD_ID AS PART_PROD_ID
            , PROD.PROD_CHRG_YN AS PROD_CHRG
            , PROD.PROD_GRD_CD
            , PROD.DRM_YN
            , PROD.REG_DT
            , PROD.CONTENTS_TYPE_CD
            , APROD.AID
            , APROD.VER_MAJOR || '.' || APROD.VER_MINOR AS PROD_VER
            , APROD.PART_PARENT_CLSF_CD
            , PDESC.PROD_NM
            , PDESC.PROD_BASE_DESC
            , TPP.PROD_AMT
            , IMG.FILE_PATH AS IMAGE_PATH
            , IMG.FILE_SIZE AS IMAGE_SIZE
            , NVL(TPS.PATICPERS_CNT, 0) AS PATICPERS_CNT
            , NVL(TPS.PRCHS_CNT, 0) AS PRCHS_CNT
            <![CDATA[
            , NVL((CASE WHEN (TPS.AVG_EVLU_SCORE > 0 AND TPS.AVG_EVLU_SCORE < 1) THEN 1
                   WHEN TPS.AVG_EVLU_SCORE > 5 THEN 5
                   ELSE ROUND(TPS.AVG_EVLU_SCORE, 1) END), 0) AS AVG_EVLU_SCORE
            ]]>
            , PDESC.PROD_DTL_DESC
            , TP.PROD_STATUS_CD
            , SC.SUB_CONTENTS_ID
            , SC.APK_PKG_NM
            , SC.APK_VER
            , MC.MENU_ID
            , MCD.MENU_NM
            , MCD.MENU_DESC
            , MC.TOP_MENU_ID
            , TMCD.MENU_NM AS TOP_MENU_NM
            , TMCD.MENU_DESC AS TOP_MENU_DESC
        FROM TB_DP_PROD PROD
            INNER JOIN TB_DP_APP_PROD APROD
              ON APROD.PROD_ID = PROD.PROD_ID
            INNER JOIN TB_DP_PROD_DESC PDESC
              ON PDESC.PROD_ID = PROD.PROD_ID -- PDESC.LANG_CD
            INNER JOIN TB_DP_SPRT_DEVICE SD
              ON SD.PROD_ID = PROD.PROD_ID
            INNER JOIN TB_DP_SUB_CONTENTS SC
              ON SC.PROD_ID = PROD.PROD_ID AND SC.SUB_CONTENTS_ID = SD.SUB_CONTENTS_ID
            INNER JOIN TB_DP_MENU_CATEGORY_PROD_MAPG MCM
              ON MCM.PROD_ID = PROD.PROD_ID AND MCM.BASE_YN = 'Y' AND MCM.USE_YN = 'Y'
            INNER JOIN TB_DP_MENU_CATEGORY MC
              ON MC.MENU_ID = MCM.MENU_ID AND MC.USE_YN = 'Y'
            INNER JOIN TB_DP_MENU_CATEGORY_DESC MCD
              ON MCD.MENU_ID = MCM.MENU_ID AND MCD.LANG_CD = 'ko'
            INNER JOIN TB_DP_MENU_CATEGORY_DESC TMCD
              ON TMCD.MENU_ID = MC.TOP_MENU_ID AND TMCD.LANG_CD = MCD.LANG_CD
            INNER JOIN TB_DP_TENANT_PROD TP
              ON TP.PROD_ID = PROD.PROD_ID -- TP.TENANT_ID
            INNER JOIN TB_DP_TENANT_PROD_PRICE TPP
              ON TPP.PROD_ID = PROD.PROD_ID AND TPP.TENANT_ID = TP.TENANT_ID
            INNER JOIN TB_DP_PROD_IMG IMG
              ON IMG.PROD_ID = PROD.PROD_ID AND IMG.LANG_CD = PDESC.LANG_CD
            LEFT OUTER JOIN TB_DP_TENANT_PROD_STATS TPS
              ON TPS.PROD_ID = PROD.PROD_ID AND TPS.TENANT_ID = TP.TENANT_ID
        WHERE 1=1
              AND PROD.PROD_ID IN <foreach collection="prodIdList" open="(" close=")" separator="," item="v">#{v}</foreach>
              AND PDESC.LANG_CD = #{langCd}
              AND SD.DEVICE_MODEL_CD = #{deviceModelCd}
              AND TP.TENANT_ID = #{tenantId}
              AND SYSDATE BETWEEN TPP.APPLY_START_DT AND TPP.APPLY_END_DT
              AND TP.EXPO_YN = 'Y'
              AND IMG.IMG_CD = #{imageCd}  --'DP000101'
              AND IMG.EXPO_ORD = 1  -- 노출순서
              AND PROD.SVC_GRP_CD = #{svcGrpCd}  -- DP000201 : App
    </select>

    <select id="getMusicMeta" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.MusicMeta">
        SELECT /* ProductInfoMapper.xml, getMusicMeta, SAC : 정희원 , 2014-04-09 */
            CPD.PROD_ID,
            EPD.PROD_ID AS PART_PROD_ID,
            TPRC.PROD_AMT,
            PDESC.PROD_NM,
            <![CDATA[
             NVL((CASE WHEN (TS.AVG_EVLU_SCORE > 0 AND TS.AVG_EVLU_SCORE < 1) THEN 1
                   WHEN TS.AVG_EVLU_SCORE > 5 THEN 5
                   ELSE ROUND(TS.AVG_EVLU_SCORE, 1)
                   END)
                  , 0) AS AVG_EVLU_SCORE,
            ]]>
            NVL(TS.PRCHS_CNT, 0) AS PRCHS_CNT,
            NVL(TS.PATICPERS_CNT, 0) AS PATICPERS_CNT,
            PDESC.ARTIST1_NM,
            PDESC.ARTIST2_NM,
            PDESC.ARTIST3_NM,
            'Y' AS MP3_SPRT_YN,
            MM.BELL_SPRT_YN,
            MM.COLORRING_SPRT_YN,
            MM.AGENCY_NM,
            MM.CHNL_COMP_NM,
            MM.OUTSD_CONTENTS_ID,
            MM.ISSUE_DAY,
            PI.FILE_PATH || PI.FILE_NM AS FILE_PATH,
            PI.FILE_NM,
            PI.FILE_SIZE,
            EPD.CONTENTS_TYPE_CD,
            TP.PROD_STATUS_CD,
            PDESC.PROD_BASE_DESC,
            PDESC.PROD_DTL_DESC,
            CPD.PROD_GRD_CD,
            CPD.META_CLSF_CD,
            MM.ALBUM_TYPE_NM,
            MC.MENU_ID,
            MD.MENU_NM,
            MD.MENU_DESC,
            CPD.TOP_MENU_ID,
            TMD.MENU_NM AS TOP_MENU_NM,
            TMD.MENU_DESC AS TOP_MENU_DESC,
            MCH.RANK_CHG_CNT,
            MCH.RANK_CHG_CLSF_CD,
            (SELECT DA.ARTIST_ID FROM TB_DP_ARTIST DA WHERE DA.ARTIST_ID = NVL(MCH.ARTIST_ID, PDESC.ARTIST1_ID)) AS ARTIST_ID,
            TO_CHAR(MCH.REG_DT, 'YYYYMMDDHH24MISS') AS REG_DT
        FROM TB_DP_PROD CPD
            INNER JOIN TB_DP_PROD_RSHP RS
                ON RS.PROD_ID = CPD.PROD_ID
            INNER JOIN TB_DP_PROD EPD
                ON EPD.PROD_ID = RS.PART_PROD_ID
            INNER JOIN TB_DP_MUSIC_PROD MM
                ON EPD.PROD_ID = MM.PROD_ID
            INNER JOIN TB_DP_PROD_DESC PDESC
                ON PDESC.PROD_ID = EPD.PROD_ID
            INNER JOIN TB_DP_MENU_CATEGORY_PROD_MAPG MCM
                ON MCM.PROD_ID = CPD.PROD_ID AND MCM.USE_YN = 'Y' AND MCM.BASE_YN = 'Y'
            INNER JOIN TB_DP_MENU_CATEGORY MC
                ON MC.MENU_ID = MCM.MENU_ID AND MC.USE_YN = 'Y'
            INNER JOIN TB_DP_MENU_CATEGORY_DESC MD
                ON MD.MENU_ID = MCM.MENU_ID
            INNER JOIN TB_DP_MENU_CATEGORY_DESC TMD
                ON TMD.MENU_ID = CPD.TOP_MENU_ID
            INNER JOIN TB_DP_PROD_IMG PI
                ON PI.PROD_ID = CPD.PROD_ID AND PI.EXPO_ORD = 1 AND PI.LANG_CD = PDESC.LANG_CD AND PI.IMG_CD = #{imageCd} -- 'DP000162'
            INNER JOIN TB_DP_TENANT_PROD TP
                ON TP.PROD_ID = EPD.PROD_ID
            INNER JOIN TB_DP_TENANT_PROD CTP
                ON CTP.PROD_ID = CPD.PROD_ID
            INNER JOIN TB_DP_TENANT_PROD_PRICE TPRC
                ON TPRC.PROD_ID = EPD.PROD_ID AND TPRC.TENANT_ID = TP.TENANT_ID
            LEFT OUTER JOIN TB_DP_TENANT_PROD_STATS TS
                ON TS.PROD_ID = CPD.PROD_ID AND TS.TENANT_ID = TP.TENANT_ID
            LEFT OUTER JOIN TB_DP_MUSIC_CHART MCH
                ON MCH.PROD_ID = EPD.PROD_ID AND MCH.CHART_CLSF_CD = #{chartClsfCd} AND MCH.RANK_START_DAY = #{rankStartDay}
        WHERE 1=1
              AND CPD.CONTENTS_TYPE_CD = 'PD002501'
              AND EPD.CONTENTS_TYPE_CD = 'PD002502'
              AND RS.PROD_RSHP_CD = 'DP010802'
              <if test="channelId != null">AND RS.PROD_ID = #{channelId}</if>
              <if test="episodeId != null">AND RS.PART_PROD_ID = #{episodeId}</if>
              AND CPD.SVC_TYPE_CD = #{svcTypeCd}
              AND EPD.SVC_TYPE_CD = CPD.SVC_TYPE_CD
              AND CPD.SVC_GRP_CD = 'DP000203'
              AND EPD.SVC_GRP_CD = #{episodeSvcGrpCd}
              AND MD.LANG_CD = #{langCd}
              AND TMD.LANG_CD = MD.LANG_CD
              AND TP.EXPO_YN = 'Y'
              AND TP.TENANT_ID = #{tenantId}
              AND PDESC.LANG_CD = MD.LANG_CD
              AND ROWNUM = 1
    </select>

    <select id="getMusicMetaList" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.MusicMeta">
        SELECT /* ProductInfoMapper.xml, getMusicMetaList, SAC : 정희원 , 2014-04-09 */
            CPD.PROD_ID,
            EPD.PROD_ID AS PART_PROD_ID,
            TPRC.PROD_AMT,
            PDESC.PROD_NM,
            <![CDATA[
                 NVL((CASE WHEN (TS.AVG_EVLU_SCORE > 0 AND TS.AVG_EVLU_SCORE < 1) THEN 1
                       WHEN TS.AVG_EVLU_SCORE > 5 THEN 5
                       ELSE ROUND(TS.AVG_EVLU_SCORE, 1)
                       END)
                      , 0) AS AVG_EVLU_SCORE,
                ]]>
            NVL(TS.PRCHS_CNT, 0) AS PRCHS_CNT,
            NVL(TS.PATICPERS_CNT, 0) AS PATICPERS_CNT,
            PDESC.ARTIST1_NM,
            PDESC.ARTIST2_NM,
            PDESC.ARTIST3_NM,
            'Y' AS MP3_SPRT_YN,
            MM.BELL_SPRT_YN,
            MM.COLORRING_SPRT_YN,
            MM.AGENCY_NM,
            MM.CHNL_COMP_NM,
            MM.OUTSD_CONTENTS_ID,
            MM.ISSUE_DAY,
            PI.FILE_PATH || PI.FILE_NM AS FILE_PATH,
            PI.FILE_NM,
            PI.FILE_SIZE,
            EPD.CONTENTS_TYPE_CD,
            TP.PROD_STATUS_CD,
            PDESC.PROD_BASE_DESC,
            PDESC.PROD_DTL_DESC,
            CPD.PROD_GRD_CD,
            CPD.META_CLSF_CD,
            MM.ALBUM_TYPE_NM,
            MC.MENU_ID,
            MD.MENU_NM,
            MD.MENU_DESC,
            CPD.TOP_MENU_ID,
            TMD.MENU_NM AS TOP_MENU_NM,
            TMD.MENU_DESC AS TOP_MENU_DESC,
            MCH.RANK_CHG_CNT,
            MCH.RANK_CHG_CLSF_CD,
        (SELECT DA.ARTIST_ID FROM TB_DP_ARTIST DA WHERE DA.ARTIST_ID = NVL(MCH.ARTIST_ID, PDESC.ARTIST1_ID)) AS ARTIST_ID,
            TO_CHAR(MCH.REG_DT, 'YYYYMMDDHH24MISS') AS REG_DT
        FROM TB_DP_PROD CPD
            INNER JOIN TB_DP_PROD_RSHP RS
            ON RS.PROD_ID = CPD.PROD_ID
            INNER JOIN TB_DP_PROD EPD
            ON EPD.PROD_ID = RS.PART_PROD_ID
            INNER JOIN TB_DP_MUSIC_PROD MM
            ON EPD.PROD_ID = MM.PROD_ID
            INNER JOIN TB_DP_PROD_DESC PDESC
            ON PDESC.PROD_ID = EPD.PROD_ID
            INNER JOIN TB_DP_MENU_CATEGORY_PROD_MAPG MCM
            ON MCM.PROD_ID = CPD.PROD_ID AND MCM.USE_YN = 'Y' AND MCM.BASE_YN = 'Y'
            INNER JOIN TB_DP_MENU_CATEGORY MC
            ON MC.MENU_ID = MCM.MENU_ID AND MC.USE_YN = 'Y'
            INNER JOIN TB_DP_MENU_CATEGORY_DESC MD
            ON MD.MENU_ID = MCM.MENU_ID
            INNER JOIN TB_DP_MENU_CATEGORY_DESC TMD
            ON TMD.MENU_ID = CPD.TOP_MENU_ID
            INNER JOIN TB_DP_PROD_IMG PI
            ON PI.PROD_ID = CPD.PROD_ID AND PI.EXPO_ORD = 1 AND PI.LANG_CD = PDESC.LANG_CD AND PI.IMG_CD = #{imageCd} -- 'DP000162'
            INNER JOIN TB_DP_TENANT_PROD TP
            ON TP.PROD_ID = EPD.PROD_ID
            INNER JOIN TB_DP_TENANT_PROD CTP
            ON CTP.PROD_ID = CPD.PROD_ID
            INNER JOIN TB_DP_TENANT_PROD_PRICE TPRC
            ON TPRC.PROD_ID = EPD.PROD_ID AND TPRC.TENANT_ID = TP.TENANT_ID
            LEFT OUTER JOIN TB_DP_TENANT_PROD_STATS TS
            ON TS.PROD_ID = CPD.PROD_ID AND TS.TENANT_ID = TP.TENANT_ID
            LEFT OUTER JOIN TB_DP_MUSIC_CHART MCH
            ON MCH.PROD_ID = EPD.PROD_ID AND MCH.CHART_CLSF_CD = #{chartClsfCd} AND MCH.RANK_START_DAY = #{rankStartDay}
        WHERE 1=1
            AND CPD.CONTENTS_TYPE_CD = 'PD002501'
            AND EPD.CONTENTS_TYPE_CD = 'PD002502'
            AND RS.PROD_RSHP_CD = 'DP010802'
            AND CPD.SVC_TYPE_CD = #{svcTypeCd}
            AND EPD.SVC_TYPE_CD = CPD.SVC_TYPE_CD
            AND CPD.SVC_GRP_CD = 'DP000203'
            AND EPD.SVC_GRP_CD = 'DP000203'
            AND MD.LANG_CD = #{langCd}
            AND TMD.LANG_CD = MD.LANG_CD
            AND TP.EXPO_YN = 'Y'
            AND TP.TENANT_ID = #{tenantId}
            AND PDESC.LANG_CD = MD.LANG_CD
            AND CPD.PROD_ID IN <foreach collection="prodIdList" open="(" close=")" separator="," item="v">#{v}</foreach>
    </select>

    <select id="getVodMeta" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.VodMeta"><![CDATA[
        SELECT /* ProductInfoMapper.xml, getVodMeta, SAC : 정희원 , 2014-04-16 */
        R.UP_MENU_ID
        , R.TOP_MENU_ID
        , R.MENU_ID
        , R.MENU_NM
        , R.MENU_DESC
        , R.META_CLSF_CD
        , R.COMPT_YN
        , R.PROD_ID
        , R.PART_PROD_ID
        , R.VOD_TITL_NM
        , R.PROD_NM
        , R.CHAPTER
        , R.SAMPL_URL
        , R.SC_SAMPL_URL
        , R.PROD_BASE_DESC
        , R.PROD_GRD_CD
        , R.ARTIST1_NM
        , R.ARTIST2_NM
        , R.ISSUE_DAY
        , R.CHNL_COMP_NM
        , R.AGENCY_NM
        , NVL(R.HDV_YN, 'N') AS HDV_YN
        , NVL(R.DOLBY_SPRT_YN, 'N') AS DOLBY_SPRT_YN
        , R.EXPO_SELLER_EMAIL
        , R.EXPO_SELLER_NM
        , R.EXPO_SELLER_TELNO
        , ( CASE WHEN R.EPSD_CNT > 0 THEN 'Y' END ) AS SUPPORT_STORE
        , ( CASE WHEN R.STRM_EPSD_CNT > 0 THEN 'Y' END ) AS SUPPORT_PLAY
        , CASE WHEN (R.CHNL_PERIOD_AMT >= 0  AND R.STRM_EPSD_CNT > 0) THEN CHNL_PERIOD_AMT
           ELSE NVL(R.CHNL_UNLMT_AMT, 0)
          END AS CHNL_PROD_AMT  /* 채널 대표 가격 */
		, CASE WHEN R.CHNL_UNLMT_AMT >= 0 THEN R.CHNL_UNLMT_AMT END AS CHNL_UNLMT_AMT  /* 채널 소장 가격 */
        , CASE WHEN R.CHNL_PERIOD_AMT >= 0 THEN R.CHNL_PERIOD_AMT END AS CHNL_PERIOD_AMT  /* 채널 대여 가격 */
        , NVL(R.PROD_AMT, 0) AS EPSD_PROD_AMT  /* 에피소드 가격 */
        , R.PROD_NET_AMT
        , (SELECT MAX(SC.PROD_AMT)
             FROM TB_DP_PROD_RSHP SA
               , TB_DP_PROD SB
               , TB_DP_TENANT_PROD_PRICE SC
               , TB_DP_TENANT_PROD SD
             WHERE SA.PROD_ID = R.PROD_ID
                   AND SA.PROD_RSHP_CD = 'DP010802'
                   AND SA.PART_PROD_ID = SB.PROD_ID
                   AND SB.CID = R.CID
                   AND SB.PROD_ID = SC.PROD_ID
                   AND SB.CONTENTS_TYPE_CD = 'PD002502'
                   AND SC.TENANT_ID = #{tenantId}
                   AND SYSDATE BETWEEN SC.APPLY_START_DT AND SC.APPLY_END_DT
                   AND SC.PROD_ID = SD.PROD_ID
                   AND SD.TENANT_ID = SC.TENANT_ID
                   AND SD.PROD_STATUS_CD = 'PD000403'
                   AND SB.USE_PERIOD_UNIT_CD = 'PD00310'
            ) AS EPSD_UNLMT_AMT  /* 에피소드 동일 CID 소장 가격 */
          , (SELECT MAX(SC.PROD_AMT)
             FROM TB_DP_PROD_RSHP SA
               , TB_DP_PROD SB
               , TB_DP_TENANT_PROD_PRICE SC
               , TB_DP_TENANT_PROD SD
             WHERE SA.PROD_ID = R.PROD_ID
                   AND SA.PROD_RSHP_CD = 'DP010802'
                   AND SA.PART_PROD_ID = SB.PROD_ID
                   AND SB.CID = R.CID
                   AND SB.PROD_ID = SC.PROD_ID
                   AND SB.CONTENTS_TYPE_CD = 'PD002502'
                   AND SC.TENANT_ID = #{tenantId}
                   AND SYSDATE BETWEEN SC.APPLY_START_DT AND SC.APPLY_END_DT
                   AND SC.PROD_ID = SD.PROD_ID
                   AND SD.TENANT_ID = SC.TENANT_ID
                   AND SD.PROD_STATUS_CD = 'PD000403'
                   AND SB.USE_PERIOD_UNIT_CD != 'PD00310'
            ) AS EPSD_PERIOD_AMT  /* 에피소드 동일 CID 대여 가격 */
        , R.PROD_CHRG_YN AS PROD_CHRG
        , NVL(R.PATICPERS_CNT, 0) AS PATICPERS_CNT
        , NVL(R.PRCHS_CNT, 0) AS PRCHS_CNT
        , NVL((CASE WHEN (R.AVG_EVLU_SCORE > 0 AND R.AVG_EVLU_SCORE < 1) THEN 1
          WHEN R.AVG_EVLU_SCORE > 5 THEN 5
            ELSE ROUND(R.AVG_EVLU_SCORE, 1)
          END), 0) AS AVG_EVLU_SCORE
        , R.FILE_PATH || R.FILE_NM AS FILE_PATH
        , R.TOP_MENU_NM
        -- , R.FILE_SIZE
        , R.PROD_DTL_DESC
        , R.PROD_STATUS_CD
        , FC_GET_CM_CD_NM(R.BRDC_COMP_CD, 'ko') AS BRDC_COMP_NM
        , R.PLAY_TM as EPSD_PLAY_TM
        FROM
        (
            SELECT
            RSHP.PROD_ID
            , RSHP.PART_PROD_ID
            , CPROD.PROD_GRD_CD
            , CPROD.USE_PERIOD_UNIT_CD
            , CPROD.META_CLSF_CD
            , CPROD.CONTENTS_TYPE_CD
            , CPROD.EXPO_SELLER_EMAIL
            , CPROD.EXPO_SELLER_NM
            , CPROD.EXPO_SELLER_TELNO
            , CPROD.DRM_YN
            , CPDESC.PROD_NM
            , CPDESC.ARTIST1_NM
            , CPDESC.ARTIST2_NM
            , CPDESC.PROD_BASE_DESC
            , CPDESC.PROD_DTL_DESC
            , CVOD.COMPT_YN
            , CVOD.VOD_TITL_NM
            , CVOD.STRM_EPSD_CNT
            , CVOD.EPSD_CNT
            , CVOD.CHNL_COMP_NM
            , CVOD.AGENCY_NM
            , CVOD.HDV_YN
            , CVOD.DOLBY_SPRT_YN
            , CVOD.BRDC_COMP_CD
            , CTPROD.TENANT_ID
            , CTPROD.PROD_STATUS_CD
            , CTPRC.CHNL_PERIOD_AMT
            , CTPRC.CHNL_UNLMT_AMT
            , CTSTAT.AVG_EVLU_SCORE
            , CTSTAT.PATICPERS_CNT
            , CTSTAT.PRCHS_CNT
            , CPI.FILE_PATH
            , CPI.FILE_NM
            , CPI.FILE_SIZE
            , EPROD.PROD_CHRG_YN
            , EVOD.CHAPTER
            , EVOD.SAMPL_URL
            , EVOD.SC_SAMPL_URL
            , EVOD.ISSUE_DAY
            , EVOD.PLAY_TM
            , ETPRC.PROD_AMT
            , ETPRC.PROD_NET_AMT
            , EMCPM.MENU_ID
            , EMC.UP_MENU_ID
            , EMC.TOP_MENU_ID
            , EMCD.MENU_NM
            , EMCD.MENU_DESC
            , TMCD.MENU_NM AS TOP_MENU_NM
            , EPROD.CID
        FROM TB_DP_PROD_RSHP RSHP
          INNER JOIN TB_DP_TENANT_PROD CTPROD
            ON CTPROD.PROD_ID = RSHP.PROD_ID
          INNER JOIN TB_DP_PROD_DESC CPDESC
            ON CPDESC.PROD_ID = CTPROD.PROD_ID
          LEFT OUTER JOIN TB_DP_PROD_IMG CPI
            ON CPI.PROD_ID = CTPROD.PROD_ID AND CPI.IMG_CD = #{imageCd} AND CPI.LANG_CD = #{langCd}
          LEFT OUTER JOIN TB_DP_TENANT_PROD_STATS CTSTAT
            ON CTSTAT.PROD_ID = CTPROD.PROD_ID AND CTSTAT.TENANT_ID = CTPROD.TENANT_ID
          INNER JOIN TB_DP_TENANT_PROD_PRICE CTPRC
            ON CTPRC.PROD_ID = CTPROD.PROD_ID AND CTPRC.TENANT_ID = CTPROD.TENANT_ID
          INNER JOIN TB_DP_PROD CPROD
            ON CPROD.PROD_ID = CTPROD.PROD_ID
          INNER JOIN TB_DP_VOD_PROD CVOD
            ON CVOD.PROD_ID = CTPROD.PROD_ID
          INNER JOIN TB_DP_PROD EPROD
            ON EPROD.PROD_ID = RSHP.PART_PROD_ID
          INNER JOIN TB_DP_VOD_PROD EVOD
            ON EVOD.PROD_ID = EPROD.PROD_ID
          INNER JOIN TB_DP_TENANT_PROD ETPROD
            ON ETPROD.PROD_ID = EPROD.PROD_ID AND ETPROD.TENANT_ID = CTPROD.TENANT_ID
          INNER JOIN TB_DP_TENANT_PROD_PRICE ETPRC
            ON ETPRC.PROD_ID = EPROD.PROD_ID AND ETPRC.TENANT_ID = CTPROD.TENANT_ID
          INNER JOIN TB_DP_MENU_CATEGORY_PROD_MAPG EMCPM
            ON EMCPM.PROD_ID = EPROD.PROD_ID
          INNER JOIN TB_DP_MENU_CATEGORY EMC
            ON EMC.MENU_ID = EMCPM.MENU_ID
          INNER JOIN TB_DP_MENU_CATEGORY_DESC EMCD
            ON EMCD.MENU_ID = EMCPM.MENU_ID AND EMCD.LANG_CD = CPDESC.LANG_CD
          INNER JOIN TB_DP_MENU_CATEGORY_DESC TMCD
            ON TMCD.MENU_ID = CPROD.TOP_MENU_ID AND TMCD.LANG_CD = CPDESC.LANG_CD
        WHERE 1 = 1 ]]>
            AND RSHP.PROD_RSHP_CD = 'DP010802'
            <if test="prodIdType == 'CHANNEL'">
            AND RSHP.PROD_ID = #{prodId}
            AND ETPROD.PROD_STATUS_CD = 'PD000403'
            </if>
            <if test="prodIdType == 'EPISODE'">
                AND RSHP.PART_PROD_ID = #{prodId}
            </if>
            AND CPROD.CONTENTS_TYPE_CD = 'PD002501'
            AND EPROD.CONTENTS_TYPE_CD = 'PD002502'
            AND CPDESC.LANG_CD = #{langCd}
            AND CTPROD.TENANT_ID = #{tenantId}
            AND CTPROD.EXPO_YN = 'Y'
            AND SYSDATE BETWEEN CTPRC.APPLY_START_DT AND CTPRC.APPLY_END_DT
            AND ETPROD.EXPO_YN = 'Y'
            AND SYSDATE BETWEEN ETPRC.APPLY_START_DT AND ETPRC.APPLY_END_DT
            AND EMCPM.BASE_YN = 'Y'
            AND EMCPM.USE_YN = 'Y'
            AND EMC.USE_YN = 'Y'
            ORDER BY EVOD.CHAPTER DESC, EPROD.REG_DT DESC
        ) R
        WHERE 1=1
        AND ROWNUM = 1
    </select>

    <select id="getEbookComicMeta" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.EbookComicMeta"><![CDATA[
        SELECT /* ProductInfoMapper.xml, getEbookComicMeta, SAC : 정희원 , 2014-04-17 */
            TB.UP_MENU_ID
            , (SELECT MENU_NM
                FROM TB_DP_MENU_CATEGORY_DESC
                WHERE MENU_ID = TB.TOP_MENU_ID
                AND LANG_CD = TB.LANG_CD
                AND ROWNUM = 1) AS TOP_MENU_NM
            , TB.TOP_MENU_ID
            , TB.MENU_ID
            , TB.MENU_NM
            , TB.MENU_DESC
            , TB.META_CLSF_CD
            , TB.PROD_ID
            , TB.PART_PROD_ID
            , TB.PROD_NM
            , TB.CHAPTER
            , TB.BOOK_CLSF_CD
            , CASE WHEN TB.TOP_MENU_ID = 'DP13'
                THEN TB.PROD_DTL_DESC
                ELSE TB.PROD_BASE_DESC
            END AS PROD_BASE_DESC
            , CASE WHEN TB.TOP_MENU_ID = 'DP13'
                THEN TB.PROD_BASE_DESC
                ELSE TB.PROD_DTL_DESC
            END AS PROD_DTL_DESC
            , TB.PROD_GRD_CD
            , TB.ARTIST1_NM
            , TB.ARTIST2_NM
            , TB.ARTIST3_NM
            , TB.ISSUE_DAY
            , TB.CHNL_COMP_NM
            , TB.SAMPL_URL
            , ( CASE WHEN TB.META_CLSF_CD IN ( 'CT20', 'CT21' ) THEN 'serial' END ) AS BOOK_TYPE
            , ( CASE WHEN TB.EPSD_CNT > 0 THEN 'Y' END ) AS SUPPORT_STORE
            , ( CASE WHEN TB.STRM_EPSD_CNT > 0 THEN 'Y' END ) AS SUPPORT_PLAY
            , TB.COMPT_YN
            , ( CASE WHEN TB.META_CLSF_CD IN ( 'CT20', 'CT21' ) THEN DECODE( TB.COMPT_YN, 'Y', 'completed', 'continue' ) END ) AS BOOK_STATUS
            , CASE WHEN (TB.CHNL_UNLMT_AMT >= 0  AND TB.EPSD_CNT > 0) THEN CHNL_UNLMT_AMT
               ELSE NVL(TB.CHNL_PERIOD_AMT, 0) END AS CHNL_PROD_AMT
            , CASE WHEN TB.CHNL_UNLMT_AMT >= 0 THEN TB.CHNL_UNLMT_AMT END AS CHNL_UNLMT_AMT  /* 채널 소장 가격 */
            , CASE WHEN TB.CHNL_PERIOD_AMT >= 0 THEN TB.CHNL_PERIOD_AMT END AS CHNL_PERIOD_AMT  /* 채널 대여 가격 */
            , NVL(TB.PROD_AMT, 0) AS EPSD_PROD_AMT
            , NVL(TB.CHNL_PROD_NET_AMT, 0) AS CHNL_PROD_NET_AMT
            , NVL(TB.EPSD_PROD_NET_AMT, 0) AS EPSD_PROD_NET_AMT
            , NVL(TB.PATICPERS_CNT, 0) AS PATICPERS_CNT
            , NVL(TB.PRCHS_CNT, 0) AS DWLD_CNT
            , NVL(TB.PRCHS_CNT, 0) AS PRCHS_CNT
            , NVL(SERIES_CONTENTS_CNT, 0) AS SERIAL_COUNT
            , NVL(BOOK_CONTENTS_CNT, 0) AS BOOK_COUNT
            , NVL(MGZIN_CONTENTS_CNT, 0) AS MAGAZINE_COUNT
            , NVL((CASE WHEN (TB.AVG_EVLU_SCORE > 0 AND TB.AVG_EVLU_SCORE < 1) THEN 1
            WHEN TB.AVG_EVLU_SCORE > 5 THEN 5
            ELSE ROUND(TB.AVG_EVLU_SCORE, 1) END), 0) AS AVG_EVLU_SCORE
            , TB.PROD_CHRG_YN AS PROD_CHRG
            , TB.FILE_PATH || TB.FILE_NM AS FILE_PATH
            , TB.PROD_STATUS_CD
            , (SELECT MAX(SC.PROD_AMT)
             FROM TB_DP_PROD_RSHP SA
               , TB_DP_PROD SB
               , TB_DP_TENANT_PROD_PRICE SC
               , TB_DP_TENANT_PROD SD
             WHERE SA.PROD_ID = TB.PROD_ID
                   AND SA.PROD_RSHP_CD = 'DP010802'
                   AND SA.PART_PROD_ID = SB.PROD_ID
                   AND SB.CID = TB.CID
                   AND SB.PROD_ID = SC.PROD_ID
                   AND SB.CONTENTS_TYPE_CD = 'PD002502'
                   AND SC.TENANT_ID = #{tenantId}
                   AND SYSDATE BETWEEN SC.APPLY_START_DT AND SC.APPLY_END_DT
                   AND SC.PROD_ID = SD.PROD_ID
                   AND SD.TENANT_ID = SC.TENANT_ID
                   AND SD.PROD_STATUS_CD = 'PD000403'
                   AND SB.USE_PERIOD_UNIT_CD = 'PD00310'
            ) AS EPSD_UNLMT_AMT  /* 에피소드 동일 CID 소장 가격 */
          , (SELECT MAX(SC.PROD_AMT)
             FROM TB_DP_PROD_RSHP SA
               , TB_DP_PROD SB
               , TB_DP_TENANT_PROD_PRICE SC
               , TB_DP_TENANT_PROD SD
             WHERE SA.PROD_ID = TB.PROD_ID
                   AND SA.PROD_RSHP_CD = 'DP010802'
                   AND SA.PART_PROD_ID = SB.PROD_ID
                   AND SB.CID = TB.CID
                   AND SB.PROD_ID = SC.PROD_ID
                   AND SB.CONTENTS_TYPE_CD = 'PD002502'
                   AND SC.TENANT_ID = #{tenantId}
                   AND SYSDATE BETWEEN SC.APPLY_START_DT AND SC.APPLY_END_DT
                   AND SC.PROD_ID = SD.PROD_ID
                   AND SD.TENANT_ID = SC.TENANT_ID
                   AND SD.PROD_STATUS_CD = 'PD000403'
                   AND SB.USE_PERIOD_UNIT_CD != 'PD00310'
            ) AS EPSD_PERIOD_AMT  /* 에피소드 동일 CID 대여 가격 */
            ]]>
            , TB.SELLER_MBR_NO
        FROM (
            SELECT
                CMC.UP_MENU_ID,
                CMC.TOP_MENU_ID,
                CMC.MENU_ID,
                CMCM.PROD_ID,
                RSHP.PART_PROD_ID,
                CMCD.MENU_NM,
                CMCD.MENU_DESC,
                CPROD.PROD_GRD_CD,
                CPROD.USE_PERIOD_UNIT_CD,
                CPROD.META_CLSF_CD,
                CPROD.CONTENTS_TYPE_CD,
                CPROD.SELLER_MBR_NO,
                CEBOOK.STRM_EPSD_CNT,
                CEBOOK.ISSUE_DAY,
                CEBOOK.CHNL_COMP_NM,
                CEBOOK.EPSD_CNT,
                CEBOOK.COMPT_YN,
                CEBOOK.SERIES_CONTENTS_CNT,
                CEBOOK.BOOK_CONTENTS_CNT,
                CEBOOK.MGZIN_CONTENTS_CNT,
                CPDESC.PROD_NM,
                CPDESC.ARTIST1_NM,
                CPDESC.ARTIST2_NM,
                CPDESC.ARTIST3_NM,
                CPDESC.PROD_BASE_DESC,
                CPDESC.PROD_DTL_DESC,
                CTPRC.CHNL_PERIOD_AMT,
                CTPRC.CHNL_UNLMT_AMT,
                EPROD.DRM_YN,
                EPROD.PROD_CHRG_YN,
                EEBOOK.CHAPTER,
                EEBOOK.BOOK_CLSF_CD,
                CPI.FILE_PATH,
                CPI.FILE_NM,
                CTSTAT.PATICPERS_CNT,
                CTSTAT.PRCHS_CNT,
                CTSTAT.AVG_EVLU_SCORE,
                ETPRC.PROD_AMT,
                CTPRC.PROD_NET_AMT AS CHNL_PROD_NET_AMT,
                ETPRC.PROD_NET_AMT AS EPSD_PROD_NET_AMT,
                CTPROD.PROD_STATUS_CD,
                CPDESC.LANG_CD,
                <if test="prodIdType == 'CHANNEL'">
                CEBOOK.SAMPL_URL,
                </if>
                <if test="prodIdType == 'EPISODE'">
                EEBOOK.SAMPL_URL,
                </if>
                EPROD.CID
            FROM TB_DP_PROD_RSHP RSHP
                INNER JOIN TB_DP_TENANT_PROD CTPROD
                ON CTPROD.PROD_ID = RSHP.PROD_ID
                INNER JOIN TB_DP_TENANT_PROD_PRICE CTPRC
                ON CTPRC.PROD_ID = RSHP.PROD_ID AND CTPRC.TENANT_ID = CTPROD.TENANT_ID
                INNER JOIN TB_DP_PROD_DESC CPDESC
                ON CPDESC.PROD_ID = RSHP.PROD_ID
                INNER JOIN TB_DP_PROD CPROD
                ON CPROD.PROD_ID = RSHP.PROD_ID
                INNER JOIN TB_DP_EBOOK_PROD CEBOOK
                ON CEBOOK.PROD_ID = RSHP.PROD_ID
                LEFT OUTER JOIN TB_DP_PROD_IMG CPI
                ON CPI.PROD_ID = CEBOOK.PROD_ID AND CPI.IMG_CD = #{imageCd} AND CPI.LANG_CD = #{langCd} AND CPI.EXPO_ORD = 1
                INNER JOIN TB_DP_TENANT_PROD ETPROD
                ON ETPROD.PROD_ID = RSHP.PART_PROD_ID AND ETPROD.TENANT_ID = CTPROD.TENANT_ID
                INNER JOIN TB_DP_TENANT_PROD_PRICE ETPRC
                ON ETPRC.PROD_ID = RSHP.PART_PROD_ID AND ETPRC.TENANT_ID = CTPROD.TENANT_ID
                INNER JOIN TB_DP_PROD EPROD
                ON EPROD.PROD_ID = RSHP.PART_PROD_ID
                INNER JOIN TB_DP_EBOOK_PROD EEBOOK
                ON EEBOOK.PROD_ID = RSHP.PART_PROD_ID
                INNER JOIN TB_DP_MENU_CATEGORY_PROD_MAPG CMCM
                ON CMCM.PROD_ID = RSHP.PROD_ID
                INNER JOIN TB_DP_MENU_CATEGORY CMC
                ON CMC.MENU_ID = CMCM.MENU_ID
                INNER JOIN TB_DP_MENU_CATEGORY_DESC CMCD
                ON CMCD.MENU_ID = CMCM.MENU_ID AND CMCD.LANG_CD = CPDESC.LANG_CD
                LEFT OUTER JOIN TB_DP_TENANT_PROD_STATS CTSTAT
                ON CTSTAT.PROD_ID = RSHP.PROD_ID AND CTSTAT.TENANT_ID = CTPROD.TENANT_ID
            WHERE 1 = 1
                AND RSHP.PROD_RSHP_CD = 'DP010802'
                AND CTPROD.TENANT_ID = #{tenantId}
                AND CPDESC.LANG_CD = #{langCd}
        <if test="prodIdType == 'CHANNEL'">
                AND RSHP.PROD_ID = #{prodId}
                AND ETPROD.PROD_STATUS_CD = 'PD000403'
        </if>
        <if test="prodIdType == 'EPISODE'">
                AND RSHP.PART_PROD_ID = #{prodId}
        </if>
                AND CPROD.CONTENTS_TYPE_CD = 'PD002501'
                AND EPROD.CONTENTS_TYPE_CD = 'PD002502'
                AND CPROD.SVC_GRP_CD = 'DP000203'
                AND SYSDATE BETWEEN CTPRC.APPLY_START_DT AND CTPRC.APPLY_END_DT
                AND SYSDATE BETWEEN ETPRC.APPLY_START_DT AND ETPRC.APPLY_END_DT
                AND CMCM.BASE_YN = 'Y'
                AND CMCM.USE_YN = 'Y'
                AND CMC.USE_YN = 'Y'
            ORDER BY
                EEBOOK.CHAPTER DESC
                , NVL(EPROD.USE_PERIOD_UNIT_CD, 'PD00310') DESC
                , EPROD.LAST_DEPLOY_DT DESC
        ) TB
        WHERE ROWNUM = 1
    </select>

    <select id="getWebtoonMeta" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.WebtoonMeta"><![CDATA[
        SELECT
            TB.UP_MENU_ID
            , (SELECT MENU_NM
            FROM TB_DP_MENU_CATEGORY_DESC
            WHERE MENU_ID = TB.TOP_MENU_ID
            AND LANG_CD = TB.LANG_CD
            AND ROWNUM = 1) AS TOP_MENU_NM
            , TB.TOP_MENU_ID
            , TB.MENU_ID
            , TB.MENU_NM
            , TB.MENU_DESC
            , TB.META_CLSF_CD
            , TB.PROD_ID
            , TB.PART_PROD_ID
            , TB.PROD_NM
            , TB.CHAPTER
            , TB.BOOK_CLSF_CD
            , TB.PROD_BASE_DESC
            , TB.PROD_GRD_CD
            , TB.ARTIST1_NM
            , TB.ARTIST2_NM
            , TB.ARTIST3_NM
            , TB.ISSUE_DAY
            , TB.CHNL_COMP_NM
            , DECODE( TB.COMPT_YN, 'Y', 'completed', 'continue' ) AS BOOK_STATUS
            , CASE WHEN (TB.CHNL_PERIOD_AMT >= 0  AND STRM_EPSD_CNT > 0) THEN CHNL_PERIOD_AMT
            ELSE NVL(CHNL_UNLMT_AMT, 0) END AS CHNL_PROD_AMT -- 채널 대표 가격
            , NVL(TB.PROD_AMT, 0) AS EPSD_PROD_AMT
            , NVL(TB.PATICPERS_CNT, 0) AS PATICPERS_CNT
            , NVL(TB.PRCHS_CNT, 0) AS DWLD_CNT
            , NVL((CASE WHEN (TB.AVG_EVLU_SCORE > 0 AND TB.AVG_EVLU_SCORE < 1) THEN 1
            WHEN TB.AVG_EVLU_SCORE > 5 THEN 5
            ELSE ROUND(TB.AVG_EVLU_SCORE, 1) END), 0) AS AVG_EVLU_SCORE
            , TB.FILE_PATH || TB.FILE_NM AS FILE_PATH
            , CASE WHEN (SYSDATE - TB.LAST_DEPLOY_DT) <= 3 THEN 'Y' ELSE 'N' END AS ICON_YN
            , TB.LAST_DEPLOY_DT AS UPD_DT
            , TB.PROD_STATUS_CD ]]>
        FROM (
            SELECT
                CMC.UP_MENU_ID,
                CMC.TOP_MENU_ID,
                CMC.MENU_ID,
                CMCM.PROD_ID,
                RSHP.PART_PROD_ID,
                CMCD.MENU_NM,
                CMCD.MENU_DESC,
                CPROD.PROD_GRD_CD,
                CPROD.USE_PERIOD_UNIT_CD,
                CPROD.META_CLSF_CD,
                CPROD.CONTENTS_TYPE_CD,
                CEBOOK.STRM_EPSD_CNT,
                CEBOOK.ISSUE_DAY,
                CEBOOK.CHNL_COMP_NM,
                CEBOOK.EPSD_CNT,
                CEBOOK.COMPT_YN,
                CPDESC.PROD_NM,
                CPDESC.ARTIST1_NM,
                CPDESC.ARTIST2_NM,
                CPDESC.ARTIST3_NM,
                CPDESC.PROD_BASE_DESC,
                CPDESC.PROD_DTL_DESC,
                CTPRC.CHNL_PERIOD_AMT,
                CTPRC.CHNL_UNLMT_AMT,
                EPROD.DRM_YN,
                EPROD.LAST_DEPLOY_DT,
                EEBOOK.CHAPTER,
                EEBOOK.BOOK_CLSF_CD,
                CPI.FILE_PATH,
                CPI.FILE_NM,
                CTSTAT.PATICPERS_CNT,
                CTSTAT.PRCHS_CNT,
                CTSTAT.AVG_EVLU_SCORE,
                ETPRC.PROD_AMT,
                ETPRC.PROD_NET_AMT,
                CTPROD.PROD_STATUS_CD,
                CPDESC.LANG_CD
            FROM TB_DP_PROD_RSHP RSHP
                INNER JOIN TB_DP_TENANT_PROD CTPROD
                  ON CTPROD.PROD_ID = RSHP.PROD_ID
                INNER JOIN TB_DP_TENANT_PROD_PRICE CTPRC
                  ON CTPRC.PROD_ID = RSHP.PROD_ID AND CTPRC.TENANT_ID = CTPROD.TENANT_ID
                INNER JOIN TB_DP_PROD_DESC CPDESC
                  ON CPDESC.PROD_ID = RSHP.PROD_ID
                INNER JOIN TB_DP_PROD CPROD
                  ON CPROD.PROD_ID = RSHP.PROD_ID
                INNER JOIN TB_DP_EBOOK_PROD CEBOOK
                  ON CEBOOK.PROD_ID = RSHP.PROD_ID
                LEFT OUTER JOIN TB_DP_PROD_IMG CPI
                  ON CPI.PROD_ID = CEBOOK.PROD_ID AND CPI.IMG_CD = #{imageCd} AND CPI.LANG_CD = #{langCd} AND CPI.EXPO_ORD = 1
                INNER JOIN TB_DP_TENANT_PROD ETPROD
                  ON ETPROD.PROD_ID = RSHP.PART_PROD_ID AND ETPROD.TENANT_ID = CTPROD.TENANT_ID
                INNER JOIN TB_DP_TENANT_PROD_PRICE ETPRC
                  ON ETPRC.PROD_ID = RSHP.PART_PROD_ID AND ETPRC.TENANT_ID = CTPROD.TENANT_ID
                INNER JOIN TB_DP_PROD EPROD
                  ON EPROD.PROD_ID = RSHP.PART_PROD_ID
                INNER JOIN TB_DP_EBOOK_PROD EEBOOK
                  ON EEBOOK.PROD_ID = RSHP.PART_PROD_ID
                INNER JOIN TB_DP_MENU_CATEGORY_PROD_MAPG CMCM
                  ON CMCM.PROD_ID = RSHP.PROD_ID
                INNER JOIN TB_DP_MENU_CATEGORY CMC
                  ON CMC.MENU_ID = CMCM.MENU_ID
                INNER JOIN TB_DP_MENU_CATEGORY_DESC CMCD
                  ON CMCD.MENU_ID = CMCM.MENU_ID AND CMCD.LANG_CD = CPDESC.LANG_CD
                LEFT OUTER JOIN TB_DP_TENANT_PROD_STATS CTSTAT
                  ON CTSTAT.PROD_ID = RSHP.PROD_ID AND CTSTAT.TENANT_ID = CTPROD.TENANT_ID
            WHERE 1 = 1
                AND RSHP.PROD_RSHP_CD = 'DP010802'
                AND CTPROD.TENANT_ID = #{tenantId}
                AND CPDESC.LANG_CD = #{langCd}
            <if test="prodIdType == 'CHANNEL'">
                AND RSHP.PROD_ID = #{prodId}
            </if>
            <if test="prodIdType == 'EPISODE'">
                AND RSHP.PART_PROD_ID = #{prodId}
            </if>
                AND CPROD.CONTENTS_TYPE_CD = 'PD002501'
                AND EPROD.CONTENTS_TYPE_CD = 'PD002502'
                AND CPROD.SVC_GRP_CD = 'DP000203'
                AND CPROD.TOP_MENU_ID = 'DP26'
                AND SYSDATE BETWEEN CTPRC.APPLY_START_DT AND CTPRC.APPLY_END_DT
                AND SYSDATE BETWEEN ETPRC.APPLY_START_DT AND ETPRC.APPLY_END_DT
                AND CMCM.BASE_YN = 'Y'
                AND CMCM.USE_YN = 'Y'
                AND CMC.USE_YN = 'Y'
            ORDER BY EPROD.LAST_DEPLOY_DT DESC
        ) TB
        WHERE ROWNUM = 1
    </select>

    <select id="getShoppingMeta" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.ShoppingMeta">
        SELECT /* ProductInfoMapper.xml, getShoppingMeta, SAC : 정희원 , 2014-04-14 */
            *
        FROM (
            SELECT
                SC.CATALOG_ID,
                SCD.CATALOG_NM,
                SCD.CATALOG_DESC,
                NVL(TPRC.PROD_NET_AMT, 0)                                                      AS PROD_NET_AMT,
                NVL(SPP.SPRC_PRICE, NVL(TPRC.DC_AFT_PROD_AMT, 0))                              AS PROD_AMT,
                NVL(SPP.SPRC_DC_RATE, NVL(TPRC.DC_RATE, 0))                                    AS DC_RATE,
                NVL(SPP.SPRC_DC_PRICE, NVL(TPRC.DC_AMT, 0))                                    AS DC_AMT,
                CASE WHEN SPP.SPRC_DC_RATE IS NOT NULL THEN 'Y'
                ELSE 'N' END                                                                   AS SPECIAL_SALE_YN,
                SBRD.BRAND_ID,
                SBRD.BRAND_NM,
                MSM.MENU_ID,
                MCD.MENU_NM,
                EPROD.TOP_MENU_ID,
                EPROD.META_CLSF_CD,
                EPROD.CONTENTS_TYPE_CD,
                (SELECT
                MENU_NM
                 FROM TB_DP_MENU_CATEGORY_DESC MTD
                 WHERE MTD.MENU_ID = EPROD.TOP_MENU_ID
                       AND MTD.LANG_CD = SCD.LANG_CD
                )                                                                              AS TOP_MENU_NM,
                CASE WHEN (SYSDATE - 7) <![CDATA[<=]]>  SPROD.REG_DT THEN 'Y'
                ELSE 'N' END                                                                   AS NEW_YN,
                SPROD.REG_DT,
                TPROD.TENANT_ID,
                RSHP.PROD_ID,
                RSHP.PART_PROD_ID,
                SPROD.DLV_PROD_YN,
                CASE WHEN NVL(TSTAT.PRCHS_CNT, 0) <![CDATA[<]]> 0 THEN 0
                ELSE NVL(TSTAT.PRCHS_CNT, 0) END                                               AS PRCHS_CNT,
                EPROD.PROD_GRD_CD,
                TO_CHAR(NVL(SPP.SPRC_APPLY_START_DT, TPRC.APPLY_START_DT), 'YYYYMMDDHH24MISS') AS APPLY_START_DT,
                TO_CHAR(NVL(SPP.SPRC_APPLY_END_DT, TPRC.APPLY_END_DT), 'YYYYMMDDHH24MISS')     AS APPLY_END_DT,
                (CASE WHEN SPROD.PROD_CASE_CD = 'DP006301' THEN 'giftcard'
                 WHEN SPROD.PROD_CASE_CD = 'DP006302' THEN 'exchange'
                 WHEN SPROD.PROD_CASE_CD = 'DP006303' THEN 'delivery'
                 END)                                                                          AS PROD_CASE_CD,
                EPROD.PROD_CHRG_YN,
                SPROD.B2B_PROD_YN,
                CONCAT(PI.FILE_PATH, PI.FILE_NM)                                                  FILE_PATH,
                PI.FILE_NM
            FROM TB_DP_SHPG_CATALOG SC
                INNER JOIN TB_DP_SHPG_CATALOG_DESC SCD
                    ON SCD.CATALOG_ID = SC.CATALOG_ID
                INNER JOIN TB_DP_SHPG_BRAND SBRD
                    ON SBRD.BRAND_ID = SC.BRAND_ID
                INNER JOIN TB_DP_PROD_CATALOG_MAPG PCM  -- chnlId - catId
                    ON PCM.CATALOG_ID = SC.CATALOG_ID
                INNER JOIN TB_DP_SHPG_PROD SPROD
                    ON SPROD.PROD_ID = PCM.PROD_ID
                INNER JOIN TB_DP_PROD_RSHP RSHP
                    ON RSHP.PROD_ID = SPROD.PROD_ID
                INNER JOIN TB_DP_PROD EPROD
                    ON EPROD.PROD_ID = RSHP.PART_PROD_ID
                INNER JOIN TB_DP_TENANT_PROD TPROD
                    ON TPROD.PROD_ID = EPROD.PROD_ID
                INNER JOIN TB_DP_TENANT_PROD_PRICE TPRC
                    ON TPRC.PROD_ID = EPROD.PROD_ID AND TPRC.TENANT_ID = TPROD.TENANT_ID
                INNER JOIN TB_DP_MENU_SHPG_MAPG MSM
                    ON MSM.CATALOG_ID = PCM.CATALOG_ID
                INNER JOIN TB_DP_MENU_CATEGORY MC
                    ON MC.MENU_ID = MSM.MENU_ID
                INNER JOIN TB_DP_MENU_CATEGORY_DESC MCD
                    ON MCD.MENU_ID = MSM.MENU_ID AND MCD.LANG_CD = SCD.LANG_CD
                LEFT OUTER JOIN TB_DP_PROD_IMG PI
                    ON PI.PROD_ID = SC.CATALOG_ID AND PI.IMG_CD = #{imageCd} AND PI.EXPO_ORD = 1 AND
                       PI.LANG_CD = #{langCd}
                LEFT OUTER JOIN TB_DP_TENANT_PROD_STATS TSTAT
                    ON TSTAT.PROD_ID = SC.CATALOG_ID AND TSTAT.TENANT_ID = TPROD.TENANT_ID
                LEFT OUTER JOIN TB_DP_SPRC_PROD SPP
                    ON SPP.PROD_ID = EPROD.PROD_ID
                       AND SPP.EXPO_YN = 'Y'
                       AND SPP.CPN_ID IS NOT NULL
                       AND SYSDATE BETWEEN SPP.SPRC_APPLY_START_DT AND SPP.SPRC_APPLY_END_DT
            WHERE 1 = 1
                  AND SC.CATALOG_ID = #{catalogId}
                  AND EPROD.SVC_GRP_CD = #{svcGrpCd}
                  AND RSHP.PROD_RSHP_CD = 'DP010802'
                  AND TPROD.TENANT_ID = #{tenantId}
                  AND TPROD.PROD_STATUS_CD = 'PD000403'
                  AND SYSDATE BETWEEN TPRC.APPLY_START_DT AND TPRC.APPLY_END_DT
                  AND NVL(SPROD.B2B_PROD_YN, 'N') != 'Y'
                  AND NVL(SC.CHNL_CNT, 0) > 0
                  AND PCM.BASE_YN = 'Y'
                  AND PCM.USE_YN = 'Y'
                  AND SCD.LANG_CD = #{langCd}
                  AND MSM.BASE_YN = 'Y'
                  AND MSM.USE_YN = 'Y'
                  AND MC.USE_YN = 'Y'
            ORDER BY NVL(SPP.SPRC_PRICE, TPRC.PROD_AMT) ASC)
        WHERE ROWNUM = 1
    </select>

    <select id="getFreepassMeta" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.FreepassMeta">
        SELECT /* ProductInfoMapper.xml, getFreepassMeta, SAC : 정희원 , 2014-04-10 */
            CPROD.PROD_ID
            , CPROD.TOP_MENU_ID
            , (SELECT MENU_DESC FROM TB_DP_MENU_CATEGORY_DESC WHERE MENU_ID = CPROD.TOP_MENU_ID AND LANG_CD = CPDESC.LANG_CD) AS TOP_MENU_NM
            , CPROD.META_CLSF_CD
            , CPROD.PROD_CHRG_YN
            , CPROD.SELLER_MBR_NO
            , CPROD.SVC_GRP_CD
            , CPROD.SVC_TYPE_CD
            , CPROD.PROD_GRD_CD
            , CPROD.CID
            , CPROD.MALL_CD
            , CPROD.FEE_CASE_CD
            , CPROD.FEE_UNIT_CD
            , CPROD.USE_PERIOD_UNIT_CD
            , CPROD.USE_PERIOD
            , CPROD.DRM_YN
            , CPROD.DRM_SET_CD
            , CPROD.DRM_SET_VALUE
            , CPROD.CONTENTS_TYPE_CD
            , CXPROD.CMPX_PROD_CLSF_CD
            , CPDESC.PROD_INTR_DSCR
            , TPRC.PROD_AMT
            , CPDESC.PROD_NM
            , CPDESC.PROD_ALIAS
            , CPDESC.PROD_BASE_DESC
            , (CASE WHEN CXPROD.CMPX_PROD_CLSF_CD = 'OR004301' THEN CPDESC.PROD_DTL_DESC ELSE '' END) as PROD_DTL_DESC 
            , CPDESC.PROD_USE_MTD
            , CXPROD.AUTO_APPR_YN
            , CXPROD.MAX_SALE_CNT
            , CXPROD.SALE_POC_CD
            , CXPROD.DUP_PRCHS_LIMT_YN
            , TP.PROD_STATUS_CD
            , TP.EXPO_YN
            , TP.EXPO_ORD
            , TO_CHAR(TPRC.APPLY_START_DT, 'YYYYMMDDHH24MISS') AS APPLY_START_DT
            , TO_CHAR(TPRC.APPLY_END_DT, 'YYYYMMDDHH24MISS') AS APPLY_END_DT
            , TPRC.CHNL_UNLMT_AMT
            , TPRC.CHNL_PERIOD_AMT
            , TPRC.PROD_NET_AMT
            , TPRC.DC_RATE
            , TPRC.DC_AMT
            , TPRC.DC_AFT_PROD_AMT
            , TPRC.TAX_CLSF
            , CPDESC.LANG_CD
            , CXPROD.CASH_AMT
            , CXPROD.BNS_CASH_AMT_CLSF_CD
            , CXPROD.BNS_CASH_AMT
            , CXPROD.BNS_CASH_RATIO
            , CXPROD.BNS_USE_PERIOD_UNIT_CD
            , CXPROD.BNS_USE_PERIOD
            , NVL(BIMG.FILE_PATH, '') || NVL(BIMG.FILE_NM, '') AS BANNER_FILE_PATH
            , NVL(TIMG.FILE_PATH, '') || NVL(TIMG.FILE_NM, '') AS THUMBNAIL_FILE_PATH
        FROM TB_DP_PROD CPROD
            INNER JOIN TB_DP_CMPX_PROD CXPROD
                ON CXPROD.PROD_ID = CPROD.PROD_ID
            INNER JOIN TB_DP_PROD_DESC CPDESC
                ON CPDESC.PROD_ID = CPROD.PROD_ID
            INNER JOIN TB_DP_TENANT_PROD TP
                ON TP.PROD_ID = CPROD.PROD_ID
            INNER JOIN TB_DP_TENANT_PROD_PRICE TPRC
                ON TPRC.PROD_ID = CPROD.PROD_ID AND TPRC.TENANT_ID = TP.TENANT_ID
            LEFT OUTER JOIN TB_DP_PROD_IMG BIMG
                ON BIMG.PROD_ID = CPROD.PROD_ID AND BIMG.LANG_CD = CPDESC.LANG_CD AND BIMG.IMG_CD = #{bannImageCd} -- Banner
            LEFT OUTER JOIN TB_DP_PROD_IMG TIMG
                ON TIMG.PROD_ID = CPROD.PROD_ID AND TIMG.LANG_CD = CPDESC.LANG_CD
                   AND TIMG.IMG_CD = (
                               CASE WHEN CXPROD.CMPX_PROD_CLSF_CD IN ('OR004301','OR004302') THEN #{thmbImageCd} -- thumbnail
                               WHEN CXPROD.CMPX_PROD_CLSF_CD IN ('OR004303','OR004304') THEN #{ebookImageCd} -- ebook thumbnail
                               END
                       )
        WHERE 1=1
              AND CPROD.SVC_GRP_CD = #{svcGrpCd} -- 'DP000207'
              AND CPROD.PROD_ID = #{prodId}
              AND CPDESC.LANG_CD = #{langCd}
              AND TP.TENANT_ID = #{tenantId}
              AND SYSDATE BETWEEN TPRC.APPLY_START_DT AND TPRC.APPLY_END_DT
    </select>

    <select id="getSubContent" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.SubContent">
        SELECT
            /* ProductInfoMapper.xml, getSubContent, 정희원, 2014-03-05 */
            SC.SUB_CONTENTS_ID,
            SC.APK_PKG_NM,
            SC.APK_VER,
            SC.FILE_SIZE
        FROM TB_DP_SPRT_DEVICE SD
            INNER JOIN TB_DP_SUB_CONTENTS SC
                ON SC.PROD_ID = SD.PROD_ID AND SC.SUB_CONTENTS_ID = SD.SUB_CONTENTS_ID
        WHERE 1 = 1
              AND SD.PROD_ID = #{prodId}
              AND SD.DEVICE_MODEL_CD = #{deviceModelCd}
    </select>

    <select id="getMenuInfo" parameterType="map" resultType="com.skplanet.storeplatform.sac.display.cache.vo.MenuInfo">
        SELECT
            /* ProductInfoMapper.xml, getMenuInfo, 정희원, 2014-03-05 */
            MM.PROD_ID,
            MC.TOP_MENU_ID,
            TMD.MENU_NM AS TOP_MENU_NM,
            TMD.MENU_DESC AS TOP_MENU_DESC,
            MC.MENU_ID,
            MD.MENU_NM,
            MD.MENU_DESC,
            MC.UP_MENU_ID
        FROM TB_DP_MENU_CATEGORY_PROD_MAPG MM
            INNER JOIN TB_DP_MENU_CATEGORY MC
                ON MC.MENU_ID = MM.MENU_ID
            INNER JOIN TB_DP_MENU_CATEGORY_DESC MD
                ON MD.MENU_ID = MM.MENU_ID
            INNER JOIN TB_DP_MENU_CATEGORY TMC
                ON TMC.MENU_ID = MC.TOP_MENU_ID
            INNER JOIN TB_DP_MENU_CATEGORY_DESC TMD
                ON TMD.MENU_ID = MC.TOP_MENU_ID AND TMD.LANG_CD = MD.LANG_CD
        WHERE 1=1
              AND MM.PROD_ID = #{prodId}
        <if test='menuId != null'>
              AND MM.MENU_ID = #{menuId}
        </if>
              AND MD.LANG_CD = #{langCd}
              AND MM.USE_YN = 'Y'
              AND MC.USE_YN = 'Y'
    </select>

</mapper>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ArtistProduct">

    <!-- 아티스트 정보 조회 -->
    <select id="selectArtistInfo" parameterType="ArtistProductSacReq" resultType="MetaInfo">
		SELECT /* ArtistProductMapper.xml, selectArtistInfo, SAC 전시 , 2014-03-08 */
		    A.ARTIST_ID
		    , A.ARTIST_NM
		    , A.IMG_FILE_PATH AS FILE_PATH
		    , A.NATY AS COUNTRY
		    , A.DEBUT_DAY
		    , A.DEBUT_MUSIC_NM
		FROM TB_DP_ARTIST A
		WHERE A.ARTIST_ID = #{artistId}
    </select>

    <!-- 특정 아티스트별 상품 조회 -->
    <select id="selectArtistProductList" parameterType="ArtistProductSacReq" resultType="ProductBasicInfo">
        SELECT /* ArtistProductMapper.xml, selectArtistInfo, SAC 전시 , 2014-03-08 */
            A.TOTAL_COUNT
            , A.RNK
            , A.TOP_MENU_ID
            , A.MENU_ID
            , A.PROD_ID AS PART_PROD_ID
            , A.CONTENTS_TYPE_CD
        FROM (
            SELECT /*+ index_ss(d IDX_DP_PROD_DESC_01) */
                COUNT(A.PROD_ID) OVER() TOTAL_COUNT
                <if test="orderedBy == 'issueDate'">
                , ROW_NUMBER() OVER(ORDER BY I.ISSUE_DAY DESC, D.PROD_NM) RNK
                </if>
                <if test="orderedBy == 'popular'">
                , ROW_NUMBER() OVER(ORDER BY NVL(H.PRCHS_CNT, 0) DESC, I.ISSUE_DAY DESC, D.PROD_NM) RNK
                </if>
                , C.TOP_MENU_ID
                , C.MENU_ID
                , A.PROD_ID
                , A.CONTENTS_TYPE_CD
            FROM 
                TB_DP_PROD A /* 에피소드 */
                , TB_DP_MENU_CATEGORY_PROD_MAPG B
                , TB_DP_MENU_CATEGORY C
                , TB_DP_PROD_DESC D
                , TB_DP_TENANT_PROD E
                , TB_DP_SPRT_DEVICE F
                , TB_CM_DEVICE G
                , TB_DP_TENANT_PROD_STATS H
                , TB_DP_MUSIC_PROD I
            WHERE A.PROD_ID = B.PROD_ID
            AND B.MENU_ID = C.MENU_ID
            AND A.PROD_ID = D.PROD_ID
            AND A.PROD_ID = E.PROD_ID
            AND A.PROD_ID = F.PROD_ID
            AND E.PROD_ID = H.PROD_ID(+)
            AND E.TENANT_ID = H.TENANT_ID(+)
            AND A.PROD_ID = I.PROD_ID
        
            AND A.CONTENTS_TYPE_CD = 'PD002502'
            AND A.META_CLSF_CD = 'CT25'
            AND B.USE_YN = 'Y'
            AND C.USE_YN = 'Y'
            AND G.USE_YN = 'Y'
            AND C.TOP_MENU_ID = 'DP16'
            AND E.PROD_STATUS_CD = 'PD000403'
            AND E.EXPO_YN = 'Y'
            AND G.MUSIC_SPRT_YN = 'Y'
        
            AND (F.DEVICE_MODEL_CD = #{deviceModelCd} OR F.DEVICE_MODEL_CD = #{mmDeviceModelCd})
            AND G.DEVICE_MODEL_CD = #{deviceModelCd}
            AND D.ARTIST1_ID = #{artistId}
            AND E.TENANT_ID = #{tenantId}
            AND D.LANG_CD = #{langCd}
        ) A
        WHERE A.RNK BETWEEN #{offset} AND #{count} + #{offset} - 1
        ORDER BY A.RNK
    </select>
            
</mapper>

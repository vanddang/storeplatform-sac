<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MemberCommon">

    <!-- 필수 약관 동의 목록 조회 -->
    <select id="getMandAgreeList" parameterType="ClauseDTO" resultType="ClauseDTO">
		SELECT /* MemberCommonMapper.getMandAgreeList, 필수약관 동의목록 조회, 심대진/다모아, 2014-01-08 */
		      A.TENANT_ID         AS tenantId
			, A.MAND_AGREE_YN     AS mandAgreeYn
			, A.USE_YN            AS useYn
		    , B.CLAUSE_ID         AS clauseId
			, B.CLAUSE_ITEM_CD    AS clauseItemCd
			, B.START_DAY         AS startDay
			, B.END_DAY           AS endDay
			, B.FILE_PATH         AS filePath
			, B.FILE_NM           AS fileNm
			, B.CLAUSE_VER        AS clauseVer
			, B.UP_CLAUSE_ID      AS upClauseId
			, B.DP_YN             AS dpYn
			, B.REG_ID            AS regId
			, B.REG_DT            AS regDt
			, B.UPD_ID            AS updId
			, B.UPD_DT            AS updDt
		FROM TB_CM_TENANT_CLAUSE A, TB_CM_CLAUSE B
		WHERE A.CLAUSE_ID = B.CLAUSE_ID
		AND A.TENANT_ID = #{tenantId}
		AND A.USE_YN = 'Y'
		AND A.MAND_AGREE_YN = 'Y'
		ORDER BY B.CLAUSE_ITEM_CD
    </select>
    
    <!-- Tenant 약관코드 조회 -->
    <select id="getTenantClauseCode" parameterType="ClauseDTO" resultType="ClauseDTO">
        SELECT    /* MemberCommonMapper.getTenantClauseCode, 테넌트약관조회, 강신완/부르칸, 2014-02-12 */
            clause_id           AS clauseId

        FROM TB_CM_TENANT_CLAUSE 
        WHERE 1=1
        
        AND clause_id = #{clauseId}
        AND use_yn = 'Y'  
        ORDER BY clause_id ASC
    </select>
    
    <!-- 약관 상세 조회 -->
    <select id="getClauseDetail" parameterType="ClauseDTO" resultType="ClauseDTO">
		SELECT    /* MemberCommonMapper.getClauseDetail, 약관상세조회, 강신완/부르칸, 2014-02-12 */
            clause_id           AS clauseId,
            clause_item_cd      AS clauseItemCd,
            start_day           AS startDay,
            end_day             AS endDay,
            file_path           AS filePath,
            file_nm             AS fileNm,
            clause_ver          AS clauseVer,
            up_clause_item_cd   AS upClauseItemCd,
            dp_yn               AS dpYn,
            reg_id              AS regId,
            TO_CHAR(reg_dt, 'YYYYMMDDHH24MISS') AS regDt, 
            upd_id AS updId, 
            TO_CHAR(upd_dt, 'YYYYMMDDHH24MISS') AS updDt 
         FROM TB_CM_CLAUSE 
        WHERE dp_yn='Y'
        
        AND clause_id = #{clauseId}
                        
        ORDER BY clause_id ASC
    </select>
    
    <!-- 약관 목록 조회 -->
    <select id="getClauseList" parameterType="ClauseDTO" resultType="ClauseDTO">
        SELECT    /* MemberCommonMapper.getClauseList, 약관목록조회, 강신완/부르칸, 2014-02-12 */
            A.clause_id           AS clauseId,
            A.clause_item_cd      AS clauseItemCd,
            A.start_day           AS startDay,
            A.end_day             AS endDay,
            A.file_path           AS filePath,
            A.file_nm             AS fileNm,
            A.clause_ver          AS clauseVer,
            A.up_clause_item_cd   AS upClauseItemCd,
            A.dp_yn               AS dpYn,
            A.reg_id              AS regId,
            TO_CHAR(A.reg_dt, 'YYYYMMDDHH24MISS') AS regDt, 
            A.upd_id AS updId, 
            TO_CHAR(A.upd_dt, 'YYYYMMDDHH24MISS') AS updDt 
         FROM TB_CM_CLAUSE A, TB_CM_TENANT_CLAUSE B
        WHERE A.dp_yn='Y'
        
        AND A.clause_id = B.clause_id
        AND (
             SELECT TO_CHAR(SYSDATE, 'YYYYMMDD') 
               FROM DUAL
            ) BETWEEN A.start_day AND A.end_day
        
        AND B.tenant_id = #{tenantId}
        AND B.use_yn = 'Y'
        ORDER BY A.clause_id ASC
    </select>
    
    <!-- 폰 정보 조회 -->
    <select id="getPhoneInfo" parameterType="DeviceDTO" resultType="DeviceDTO">
		SELECT /* MemberCommonMapper.getPhoneInfo, 폰정보 조회, 심대진/다모아, 2014-01-08 */
            DEVICE_MODEL_CD,
			MODEL_NM,
			ENG_MODEL_NM,
			REP_DEVICE_YN,
			UA_CD,
			LIST_IMG_PATH,
			DTL_IMG_PATH,
			CMNT_COMP_CD,
			CPU_TYPE_CD,
			VM_VER_CD,
			LCD_SIZE_CD,
			COLOR_CD,
			AUDIO_TYPE_CD,
			AUDIO_POLY_CD,
			GIGA_VER_CD,
			DRM_VER_CD,
			V4_SPRT_TYPE_CD,
			DEVICE_TYPE_CD,
			PRCHS_POSB_TYPE_CD,
			INNER_MEM_SIZE,
			NETWORK_TYPE,
			USE_YN,
			DP_YN,
			FEATURE_PHONE_YN,
			CAMERA_SPRT_YN,
			EXTRR_MEM_YN,
			TOUCH_SCREEN_YN,
			BLUETOOTH_SPRT_YN,
			GPS_SPRT_YN,
			ITOPP_V4_SPRT_YN,
			SOUND_3D_SPRT_YN,
			VIRTUAL_KEY_YN,
			T_PLAYER_SPRT_YN,
			VIDEO_DRM_SPRT_YN,
			CMF_SPRT_YN,
			EMBEDDED_YN,
			WSL_SPRT_YN,
			SD_VIDEO_SPRT_YN,
			FR_DVC_YN,
			VERIFY_DVC_YN,
			EBOOK_SPRT_YN,
			COMIC_SPRT_YN,
			HDV_SPRT_YN,
			KPAD_SPRT_YN,
			KWAC_SPRT_YN,
			FLASH_SPRT_YN,
			HDMI_SPRT_YN,
			HDCP_SPRT_YN,
			GIFT_SPRT_YN,
			SCL_SHPG_SPRT_YN,
			MAGAZINE_SPRT_YN,
			MUSIC_SPRT_YN,
			AOM_SPRT_YN,
			SKT_DRM_SPRT_YN,
			STRM_SPRT_YN,
			WGTP_SPRT_YN,
			ARM_SPRT_YN,
			VOD_FIXISTT_SPRT_YN,
			DOLBY_SPRT_YN,
			WEBTOON_SPRT_YN,
			REG_ID,
			REG_DT,
			UPD_ID,
			UPD_DT,
			(SELECT CD_NM FROM TB_CM_CD WHERE CD_ID = MNFT_COMP_CD AND LANG_CD = 'ko') AS MNFT_COMP_CD,
            (SELECT CD_NM FROM TB_CM_CD WHERE CD_ID = VM_TYPE_CD AND LANG_CD = 'ko') AS VM_TYPE_CD
        FROM TB_CM_DEVICE
        WHERE REP_DEVICE_YN = 'Y'
        <if test='deviceModelCd != null'>
        AND DEVICE_MODEL_CD = #{deviceModelCd}
        </if>
        <if test='uaCd != null'>
        AND UA_CD = #{uaCd}
        </if>
        
    </select>

    <!-- OMD 단말여부 확인 -->
    <select id="getOmdCount" parameterType="String" resultType="Integer">
        SELECT /* MemberCommonMapper.getOmdCount, OMD 단말여부 확인, 심대진/다모아, 2014-01-17 */
               COUNT(1)
          FROM TB_CM_OMD_DEVICE
         WHERE UA_CD = #{uacd}
    </select>
    
    <!-- 공통 약관 코드 정보 조회 -->
    <select id="getClauseItemInfo" parameterType="ClauseDTO" resultType="ClauseDTO">
		SELECT /* MemberCommonMapper.getClauseItemInfo, 공통 약관 코드 정보 조회, 심대진/다모아, 2014-04-04 */
			   A.CLAUSE_ID AS clauseId,
			   A.START_DAY AS startDay,
			   A.END_DAY AS endDay,
			   A.CLAUSE_VER AS clauseVer,
			   B.MAND_AGREE_YN AS mandAgreeYn
		FROM TB_CM_CLAUSE A, TB_CM_TENANT_CLAUSE B
		WHERE A.CLAUSE_ID = B.CLAUSE_ID
		AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN A.START_DAY AND A.END_DAY
		AND B.USE_YN = 'Y'
		AND B.TENANT_ID = #{tenantId}
		AND A.CLAUSE_ID = #{clauseId}
    </select>
    
</mapper>
